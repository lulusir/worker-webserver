"use strict";(()=>{var h=Object.defineProperty;var y=(r,e,t)=>e in r?h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var f=(r,e,t)=>(y(r,typeof e!="symbol"?e+"":e,t),t);var l={Ready:"Ready",Close:"Close"};var o=class{constructor(e){this.pipe=e}getNewPid(){return this.pipe.newid}consume(e,t){this.pipe.write(e,t)}async send(e,t,i){if(i){let n={pid:e,data:t};i.postMessage(n)}}async receive(e){return this.pipe.read(e).then(t=>t.data)}};var c=class{constructor(e,t){this.pipeMessage=e;this.sw=t}async getClient(e){return await this.sw.clients.get(e)}async buildResponse(e){let t=this.pipeMessage.getNewPid(),i=await this.getClient(e.clientId);return i?this.pipeMessage.send(t,{req:this.serializeRequest(e.request)},i):console.warn("client not found",e),this.pipeMessage.receive(t).then(n=>n.status===0?new Response(n.body):fetch(e.request))}serializeRequest(e){let t={url:e.url,method:e.method,headers:{},referrer:e.referrer,referrerPolicy:e.referrerPolicy,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,integrity:e.integrity,keepalive:e.keepalive};for(let[i,n]of e.headers.entries())t.headers[i]=n;return t}};var p=class{static single(){return p._instance}_id=1;get newid(){return this._id++}_pipe=new Map;read(e){return new Promise(t=>{this._pipe.set(e,{resolve:t})})}write(e,t){if(this._pipe.has(e)){let{resolve:i}=this._pipe.get(e);i&&i(t),this._pipe.delete(e)}}size(){return this._pipe.size}},a=p;f(a,"_instance",new p);function m(r){return/^(http|https):\/\//i.test(r)}var d=class{value="default";ready(){this.value="ready"}close(){this.value="close"}isReady(){return this.value==="ready"}};var s=self,u=new d,w=a.single(),g=new o(w),b=new c(g,s);s.addEventListener("install",function(){s.skipWaiting()});s.addEventListener("activate",function(r){r.waitUntil(s.clients.claim())});s.addEventListener("message",r=>{if(r.data===l.Ready){u.ready();return}if(r.data===l.Close){u.close();return}if(r.data?.pid){let{pid:e}=r.data;g.consume(e,r.data);return}});s.addEventListener("fetch",r=>{if(!u.isReady())return;let{request:e}=r;(e.headers.get("accept")||"").includes("text/event-stream")||e.mode!=="navigate"&&(e.cache==="only-if-cached"&&e.mode!=="same-origin"||m(e.url)&&r.respondWith(b.buildResponse(r)))});})();
