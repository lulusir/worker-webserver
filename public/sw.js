"use strict";(()=>{var R=Object.defineProperty;var b=(t,e,r)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var f=(t,e,r)=>(b(t,typeof e!="symbol"?e+"":e,r),r);var l={Ready:"Ready",Close:"Close"};var a=class{constructor(e){this.pipe=e}getNewPid(){return this.pipe.newid}consume(e,r){this.pipe.write(e,r)}async send(e,r,n){if(n){let s={pid:e,data:r};n.postMessage(s)}}async receive(e){return this.pipe.read(e).then(r=>r.data)}};function g(t){let e=new Headers(t.headers),r={status:t.status,statusText:t.statusText,headers:e};if(t.body!==null){let n=e.get("content-type");if(n&&n.includes("application/json")){let s=JSON.parse(t.body);return new Response(JSON.stringify(s),r)}else if(n&&n.includes("application/octet-stream")){let s=w(t.body);return new Response(s,r)}else return new Response(t.body,r)}else return new Response(null,r)}function w(t){let e=new ArrayBuffer(t.length),r=new Uint8Array(e);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return e}var y=10086;var c=class{constructor(e,r){this.pipeMessage=e;this.sw=r}async getClient(e){return await this.sw.clients.get(e)}async buildResponse(e){let r=this.pipeMessage.getNewPid(),n=await this.getClient(e.clientId);return n?this.pipeMessage.send(r,{req:this.serializeRequest(e.request)},n):console.warn("client not found",e),this.pipeMessage.receive(r).then(s=>s.res.status===y?fetch(e.request):g(s.res))}serializeRequest(e){let r={url:e.url,method:e.method,headers:{},referrer:e.referrer,referrerPolicy:e.referrerPolicy,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,integrity:e.integrity,keepalive:e.keepalive};for(let[n,s]of e.headers.entries())r.headers[n]=s;return r}};var u=class{static single(){return u._instance}_id=1;get newid(){return this._id++}_pipe=new Map;read(e){return new Promise(r=>{this._pipe.set(e,{resolve:r})})}write(e,r){if(this._pipe.has(e)){let{resolve:n}=this._pipe.get(e);n&&n(r),this._pipe.delete(e)}}size(){return this._pipe.size}},o=u;f(o,"_instance",new u);function h(t){return/^(http|https):\/\//i.test(t)}var p=class{value="default";ready(){this.value="ready"}close(){this.value="close"}isReady(){return this.value==="ready"}};var i=self,d=new p,x=o.single(),m=new a(x),v=new c(m,i);i.addEventListener("install",function(){i.skipWaiting()});i.addEventListener("activate",function(t){t.waitUntil(i.clients.claim())});i.addEventListener("message",t=>{if(t.data===l.Ready){d.ready();return}if(t.data===l.Close){d.close();return}if(t.data?.pid){let{pid:e}=t.data;m.consume(e,t.data);return}});i.addEventListener("fetch",t=>{if(!d.isReady())return;let{request:e}=t;(e.headers.get("accept")||"").includes("text/event-stream")||e.mode!=="navigate"&&(e.cache==="only-if-cached"&&e.mode!=="same-origin"||h(e.url)&&t.respondWith(v.buildResponse(t)))});})();
